shiny::runApp()
runApp('~/Documents/GitHub/Spring2019-Proj2-grp11/app')
shiny::runApp()
shiny::runApp()
shiny::runApp()
runApp()
taxidatatemp%>%select(PU.Borough,pu_wl)%>%unique()
library(sp)
library(dplyr)
taxidatatemp%>%select(PU.Borough,pu_wl)%>%unique()
library(sp)
library(dplyr)
setwd("../")
load('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/output/nyc_nbhd.RData')
taxi1<-read.csv('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/output/taxi2016_1.csv')
taxi2<-read.csv('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/output/taxi2016_2.csv')
weather<-read.csv('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/data/weather_small.csv')
#weather2<-read.csv('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/data/weather.csv')
#nyc_neighborhoods
nbhd<-function(ll){
colnames(ll)=c('lon','lat')
ll_spdf<-ll
coordinates(ll_spdf)= ~lon + lat
proj4string(ll_spdf) <- proj4string(nyc_nbhd)
match<-over(ll_spdf, nyc_nbhd)
return(match[,c(1,3)])
}
#taxi1
pickupnbhd1<-taxi1%>%select(PU.lon,PU.lat)%>%nbhd()
colnames(pickupnbhd1)<-c('PUnbhd','PUnbhdBorough')
dropoffnbhd1<-taxi1%>%select(DO.lon,DO.lat)%>%nbhd()
colnames(dropoffnbhd1)<-c('DOnbhd','DOnbhdBorough')
#taxi2
pickupnbhd2<-taxi2%>%select(PU.lon,PU.lat)%>%nbhd()
colnames(pickupnbhd2)<-c('PUnbhd','PUnbhdBorough')
dropoffnbhd2<-taxi2%>%select(DO.lon,DO.lat)%>%nbhd()
colnames(dropoffnbhd2)<-c('DOnbhd','DOnbhdBorough')
updatetaxi1<-cbind(taxi1,pickupnbhd1,dropoffnbhd1)
updatetaxi2<-cbind(taxi2,pickupnbhd2,dropoffnbhd2)
taxidata<-rbind(updatetaxi1,updatetaxi2)
head(weather)
#weather$LATITUDE<-round(weather$LATITUDE,5)
#weather$LONGITUDE<-round(weather$LONGITUDE,5)
#weather%>%group_by(DATE)%>%tally()
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE')))
#ifelse(PU.Borough %in% c('EWR','Staten Island'),'WOODBRIDGE',NULL)   )))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE')))
#(ppppppppp<-weather%>%select(NAME,LONGITUDE,LATITUDE)%>%unique())
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_weather'
do_weather<-taxidatatemp%>%left_join(weather,by=c('do_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_weather'
taxi<-cbind(taxidata,pu_weather,do_weather)
head(taxi)
taxidatatemp%>%select(PU.Borough,pu_wl)%>%unique()
taxidatatemp%>%select(pu_date)%>%head()
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE')))
#ifelse(PU.Borough %in% c('EWR','Staten Island'),'WOODBRIDGE',NULL)   )))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE')))
head(taxidatatemp)
#(ppppppppp<-weather%>%select(NAME,LONGITUDE,LATITUDE)%>%unique())
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
head(taxidatatemp)
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
str(weather$NAME)
as.character(weather$NAME)%>%head()
as.character(weather$NAME)%>%head()str()
str(as.character(weather$NAME)%>%head())
#weather$LATITUDE<-round(weather$LATITUDE,5)
#weather$LONGITUDE<-round(weather$LONGITUDE,5)
#weather%>%group_by(DATE)%>%tally()
weather$NAME<-as.character(weather$NAME)
colnames(pu_weather)<-'pu_weather'
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
str(weather$NAME)
str(weather$DATE)
weather$DATE<-as.character(weather$DATE)
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_weather'
do_weather<-taxidatatemp%>%left_join(weather,by=c('do_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_weather'
taxi<-cbind(taxidata,pu_weather,do_weather)
head(taxi)
taxi$pu_weather%>%unique()
taxi%>%filter(pu_weather=='NA')
taxi%>%filter(pu_weather='NA')
taxi%>%filter(pu_weather==0)
dim(taxi%>%filter(pu_weather==0))
dim(taxi%>%filter(pu_weather==1))
540262+508183
dim(taxidata)
dim(taxi)
?is.na
subset(taxi,is.na(taxi))
subset(taxi,is.na(taxi$pu_weather))
subset(pu_weather,is.na(pu_weather$BAD_WEATHER))
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE')))
#ifelse(PU.Borough %in% c('EWR','Staten Island'),'WOODBRIDGE',NULL)   )))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE')))
#(ppppppppp<-weather%>%select(NAME,LONGITUDE,LATITUDE)%>%unique())
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))
pu_weather$BAD_WEATHER%>%unique()
subset(pu_weather,is.na(pu_weather$BAD_WEATHER))
dim(subset(pu_weather,is.na(pu_weather$BAD_WEATHER)))
yyyyyy=subset(pu_weather,is.na(pu_weather$BAD_WEATHER))
yyyyyy
yyyyyy[1277,]
yyyyyy[1,]
weather%>%filter(NAME=='WOODBRIDGE',DATE=='2016-12-20')
weather%>%filter(NAME=='WOODBRIDGE',DATE=='2016-12-21')
yyyyyy[2,]
weather%>%filter(NAME=='WOODBRIDGE',DATE=='2016-08-18')
weather%>%filter(NAME=='WOODBRIDGE')
table(taxidatatemp$PU.Borough)
weather$NAME
weather$NAME%>%unique()
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#ifelse(PU.Borough %in% c('EWR','Staten Island'),'WOODBRIDGE',NULL)   )))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US',
'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#(ppppppppp<-weather%>%select(NAME,LONGITUDE,LATITUDE)%>%unique())
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))
subset(pu_weather,is.na(pu_weather$BAD_WEATHER))
pu_weather
pu_weather$BAD_WEATHER%>%unique()
weather<-read.csv('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/data/weather_small.csv',as.is=TRUE)
str(weather)
setwd("../")
load('../output/nyc_nbhd.RData')
library(sp)
library(dplyr)
setwd("../")
getwd()
library(sp)
library(dplyr)
setwd("../")
getwd()
load('../output/nyc_nbhd.RData')
taxi1<-read.csv('../output/taxi2016_1.csv')
taxi2<-read.csv('../output/taxi2016_2.csv')
weather<-read.csv('../data/weather_small.csv',as.is=TRUE)
#nyc_neighborhoods
nbhd<-function(ll){
colnames(ll)=c('lon','lat')
ll_spdf<-ll
coordinates(ll_spdf)= ~lon + lat
proj4string(ll_spdf) <- proj4string(nyc_nbhd)
match<-over(ll_spdf, nyc_nbhd)
return(match[,c(1,3)])
}
#taxi1
pickupnbhd1<-taxi1%>%select(PU.lon,PU.lat)%>%nbhd()
colnames(pickupnbhd1)<-c('PUnbhd','PUnbhdBorough')
dropoffnbhd1<-taxi1%>%select(DO.lon,DO.lat)%>%nbhd()
colnames(dropoffnbhd1)<-c('DOnbhd','DOnbhdBorough')
#taxi2
pickupnbhd2<-taxi2%>%select(PU.lon,PU.lat)%>%nbhd()
colnames(pickupnbhd2)<-c('PUnbhd','PUnbhdBorough')
dropoffnbhd2<-taxi2%>%select(DO.lon,DO.lat)%>%nbhd()
colnames(dropoffnbhd2)<-c('DOnbhd','DOnbhdBorough')
updatetaxi1<-cbind(taxi1,pickupnbhd1,dropoffnbhd1)
updatetaxi2<-cbind(taxi2,pickupnbhd2,dropoffnbhd2)
taxidata<-rbind(updatetaxi1,updatetaxi2)
#add columns
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
#left join weather data
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_weather'
do_weather<-taxidatatemp%>%left_join(weather,by=c('do_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_weather'
taxi<-cbind(taxidata,pu_weather,do_weather)
head(taxi)
setwd("../")
save(taxidata, file = "output/taxidata.RData")
taxidata<-cbind(taxidata,pu_weather,do_weather)
head(taxidata)
save(taxidata, file = "output/taxidata.RData")
save(taxidata, file = "..output/taxidata.RData")
getwd()
save(taxidata, file = "..output/taxidata.RData")
library(sp)
library(dplyr)
setwd("../")
getwd()
save(taxidata, file = "..output/taxidata.RData")
setwd("../")
save(taxidata, file = "..output/taxidata.RData")
updatetaxi1<-cbind(taxi1,pickupnbhd1,dropoffnbhd1)
updatetaxi2<-cbind(taxi2,pickupnbhd2,dropoffnbhd2)
taxidata<-rbind(updatetaxi1,updatetaxi2)
#add columns
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
#left join weather data
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_weather'
do_weather<-taxidatatemp%>%left_join(weather,by=c('do_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_weather'
taxi<-cbind(taxidata,pu_weather,do_weather)
setwd("../")
save(taxi, file = "..output/taxidata.RData")
?save
setwd("../")
save(taxi, file = "..output/taxidata.RData")
setwd("../")
save(taxi, file = "..output/taxidata.RData")
save(taxi, file = "..output/taxidata.RData")
setwd("../")
save(taxi, file = "..output/taxidata.RData")
