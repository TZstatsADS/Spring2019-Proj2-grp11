if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
par(mfrow=c(5,6))
for (i in 1:30){
a=lllll[i]
plot(c(0,0,0,predtable[,a]),ylab=paste(colnames(predtable)[a]))
}
par(mfrow=c(5,6))
for (i in 1:30){
a=lllll[i]
plot(c(0,0,0,predtable[,a]),ylab=paste(colnames(predtable)[a]))
}
library(tidyverse)
library(reshape2)
library(ggmap)
library(tigris)
library(leaflet)
library(sp)
load('/Users/yeyejiang/Desktop/DO_data.RData')
load('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/output/nyc_nbhd.RData')
#Allcount2$DOnbhd=as.character(Allcount2$DOnbhd)
dim(Allcount2)
tttbbb=dcast(Allcount2,DOnbhd~dropoff_hour, value.var='totalcount')
tttbbb[is.na(tttbbb)] <- 0
rownames(tttbbb)=tttbbb[,1]
tttbbb=tttbbb[2:25]
# tttbbb['Central Park',]
# tttbbb[38,]
# which.max(tttbbb[38,] )
# 16
# tttbbb
lllll=which(apply(tttbbb>200,1,sum)==24)
uuuuu=which(apply((tttbbb<200&tttbbb>100),1,sum)>5)
drtb=tttbbb[,c(5:24,1:4)]
x=c(1:24)
pred=function(y){
lo <- loess(y~x)
value=predict(lo, data.frame(c(1:24)), se = TRUE)$fit
value
}
predtable=apply(drtb,1,'pred')
countconvex=function(z){
c=diff(z)%>%sign()%>%diff()
return(c==-2)
}
convextable=apply(predtable,2,'countconvex')
#convextable[,38]
#dim(convextable)
#which(convextable[,20]=='TRUE')+1
whichcountconvex=function(z){
c=diff(z)%>%sign()%>%diff()
return(as.integer(which(c==-2)+5))
}
peak=apply(predtable,2,'whichcountconvex')
peak[[38]]
nbhd<-rownames(tttbbb)
xx=c(1:254)
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
if_else(length(peak[[i]])==2, 'Work Area',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
par(mfrow=c(5,6))
for (i in 1:30){
a=lllll[i]
plot(c(0,0,0,predtable[,a]),ylab=paste(colnames(predtable)[a]))
}
tempt
tempt
nbhd<-rownames(tttbbb)
xx=c(1:254)
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(20:23)) ==1, 'Entertainment',
if_else(length(peak[[i]])==2, 'Work Area',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt
tempt%>%filter(nbhd=='East Village')
par(mfrow=c(5,6))
for (i in 1:30){
a=lllll[i]
plot(c(0,0,0,predtable[,a]),ylab=paste(colnames(predtable)[a]))
}
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
nbhd<-rownames(tttbbb)
xx=c(1:254)
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:24)) ==1, 'Entertainment',
if_else(length(peak[[i]])==2, 'Work Area',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
head(peak)
peak$`East Village`
sum(2,3)
nbhd<-rownames(tttbbb)
xx=c(1:254)
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(7:10), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
peak
nbhd<-rownames(tttbbb)
xx=c(1:254)
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
par(mfrow=c(5,6))
for (i in 1:30){
a=lllll[i]
plot(c(0,0,0,predtable[,a]),ylab=paste(colnames(predtable)[a]))
}
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:21)) ==2, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:21)) ==2, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt
tempt$>$filter(xx=='Work Area')
tempt%>%filter(xx=='Work Area')
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
par(mfrow=c(5,6))
for (i in 1:30){
a=lllll[i]
plot(c(0,0,0,predtable[,a]),ylab=paste(colnames(predtable)[a]))
}
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:11)) ==1, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt%>%filter(xx=='Work Area')
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:10)) ==1, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt%>%filter(xx=='Work Area')
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:10)) ==1, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt%>%filter(xx=='Work Area')
tempt
table(tempt)
table(tempt$xx)
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:10)) ==1, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt%>%filter(xx=='Work Area')
nbhd<-rownames(tttbbb)
xx=c(1:254)
# for (i in 1:254){
#   xx[i]=if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
#                 if_else(sum(peak[[i]] %in% c(7:13), peak[[i]] %in% c(17:20)) ==2, 'Work Area',
#                         if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
#                                'Else'
#                                #  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#                                 #         )
#                                  )
#                          )
#                 )
# }
for (i in 1:254){
xx[i]=if_else(sum(peak[[i]] %in% c(7:10)) ==1, 'Work Area',
if_else(sum(peak[[i]] %in% c(14:16)) ==1, 'Attractions',
if_else(sum(peak[[i]] %in% c(21:23)) ==1, 'Entertainment',
'Else'
#  if_else((apply(predtable,2,which.max) %in% c(21:24,1))=='TRUE','Residential Area', 'Else'
#         )
)
)
)
}
tempt<-data.frame(cbind(nbhd,xx))
tempt$xx<-as.character(tempt$xx)
if_res<-apply(predtable,2,which.max) %in% c(21:24,1,2)
if_els<-tempt$xx=='Else'
tempt[if_res+if_els==2,]$xx='Residential Area'
table(tempt[,'xx'])
tempt<-tempt%>%mutate('index'= if_else(xx=='Attractions',5,
if_else(xx=='Entertainment',2,
if_else(xx=='Residential Area',3,
if_else(xx=='Work Area', 4,1)
))))
tempt%>%filter(xx=='Work Area')
table(tempt$xx)
tempt%>%filter(nbhd=='East Village')
save(tempt,file ='/Users/yeyejiang/Desktop/cluster1.RData')
