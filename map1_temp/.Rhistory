pu_weather
pu_weather$BAD_WEATHER%>%unique()
weather<-read.csv('/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/data/weather_small.csv',as.is=TRUE)
str(weather)
setwd("../")
load('../output/nyc_nbhd.RData')
library(sp)
library(dplyr)
setwd("../")
getwd()
library(sp)
library(dplyr)
setwd("../")
getwd()
load('../output/nyc_nbhd.RData')
taxi1<-read.csv('../output/taxi2016_1.csv')
taxi2<-read.csv('../output/taxi2016_2.csv')
weather<-read.csv('../data/weather_small.csv',as.is=TRUE)
#nyc_neighborhoods
nbhd<-function(ll){
colnames(ll)=c('lon','lat')
ll_spdf<-ll
coordinates(ll_spdf)= ~lon + lat
proj4string(ll_spdf) <- proj4string(nyc_nbhd)
match<-over(ll_spdf, nyc_nbhd)
return(match[,c(1,3)])
}
#taxi1
pickupnbhd1<-taxi1%>%select(PU.lon,PU.lat)%>%nbhd()
colnames(pickupnbhd1)<-c('PUnbhd','PUnbhdBorough')
dropoffnbhd1<-taxi1%>%select(DO.lon,DO.lat)%>%nbhd()
colnames(dropoffnbhd1)<-c('DOnbhd','DOnbhdBorough')
#taxi2
pickupnbhd2<-taxi2%>%select(PU.lon,PU.lat)%>%nbhd()
colnames(pickupnbhd2)<-c('PUnbhd','PUnbhdBorough')
dropoffnbhd2<-taxi2%>%select(DO.lon,DO.lat)%>%nbhd()
colnames(dropoffnbhd2)<-c('DOnbhd','DOnbhdBorough')
updatetaxi1<-cbind(taxi1,pickupnbhd1,dropoffnbhd1)
updatetaxi2<-cbind(taxi2,pickupnbhd2,dropoffnbhd2)
taxidata<-rbind(updatetaxi1,updatetaxi2)
#add columns
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
#left join weather data
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_weather'
do_weather<-taxidatatemp%>%left_join(weather,by=c('do_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_weather'
taxi<-cbind(taxidata,pu_weather,do_weather)
head(taxi)
setwd("../")
save(taxidata, file = "output/taxidata.RData")
taxidata<-cbind(taxidata,pu_weather,do_weather)
head(taxidata)
save(taxidata, file = "output/taxidata.RData")
save(taxidata, file = "..output/taxidata.RData")
getwd()
save(taxidata, file = "..output/taxidata.RData")
library(sp)
library(dplyr)
setwd("../")
getwd()
save(taxidata, file = "..output/taxidata.RData")
setwd("../")
save(taxidata, file = "..output/taxidata.RData")
updatetaxi1<-cbind(taxi1,pickupnbhd1,dropoffnbhd1)
updatetaxi2<-cbind(taxi2,pickupnbhd2,dropoffnbhd2)
taxidata<-rbind(updatetaxi1,updatetaxi2)
#add columns
taxidatatemp<-taxidata%>%mutate(pu_wl=if_else(PU.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(PU.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(do_wl=if_else(DO.Borough %in% c('Manhattan', 'Bronx', 'Unknown'), 'NY CITY CENTRAL PARK, NY US',
if_else(DO.Borough %in% c('Brooklyn','Queens'), 'LA GUARDIA AIRPORT, NY US','WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxidatatemp<-taxidatatemp%>%mutate(pu_date=substring(tpep_pickup_datetime,1,10),do_date=substring(tpep_dropoff_datetime,1,10))
#left join weather data
pu_weather<-taxidatatemp%>%left_join(weather,by=c('pu_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_weather'
do_weather<-taxidatatemp%>%left_join(weather,by=c('do_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_weather'
taxi<-cbind(taxidata,pu_weather,do_weather)
setwd("../")
save(taxi, file = "..output/taxidata.RData")
?save
setwd("../")
save(taxi, file = "..output/taxidata.RData")
setwd("../")
save(taxi, file = "..output/taxidata.RData")
save(taxi, file = "..output/taxidata.RData")
setwd("../")
save(taxi, file = "..output/taxidata.RData")
shiny::runApp()
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
dim(PUcount)
library(sp)
library(dplyr)
setwd("../")
getwd()
################################
#########change this############
################################
load('taxi2016_9.RData')
load('../output/nyc_nbhd.RData')
weather<-read.csv('../data/weather_small.csv',as.is=TRUE)
#taxi2016_9
(a<-dim(taxi2016_9))
head(taxi2016_9)
filtaxi <- taxi2016_9%>%
mutate(fpd=fare_amount/trip_distance)%>%
filter(trip_distance<80 & trip_distance>0)%>%
filter(fare_amount<200 & fare_amount>0)%>%
filter(fpd<10 & fpd>0.5)
(b<-dim(filtaxi))
#filtaxi%>%select(fpd)%>%boxplot()
nbhd<-function(ll){
colnames(ll)=c('lon','lat')
ll_spdf<-ll
coordinates(ll_spdf)= ~lon + lat
proj4string(ll_spdf) <- proj4string(nyc_nbhd)
match<-over(ll_spdf, nyc_nbhd)
return(match[,c(1,3)])
}
punbhd<-filtaxi%>%
select(pickup_longitude,pickup_latitude)%>%
nbhd()
colnames(punbhd)<-c('PUnbhd','PUnbhdBorough')
donbhd<-filtaxi%>%
select(pickup_longitude,pickup_latitude)%>%
nbhd()
colnames(donbhd)<-c('DOnbhd','DOnbhdBorough')
dim(punbhd)
dim(donbhd)
taxitemp<-cbind(filtaxi,punbhd,donbhd)
dim(taxitemp)
taxitemp1<- taxitemp%>%na.omit()
c<-(dim(taxitemp1))
taxitemp1<- taxitemp%>%na.omit()
(c<-dim(taxitemp1))
head(taxitemp1)
taxitemp2<-taxitemp1%>%mutate(pu_wl=if_else(PUnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(PUnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxitemp3<-taxitemp2%>%mutate(do_wl=if_else(DOnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(DOnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#left join weather data
pu_weather<-taxitemp3%>%left_join(weather,by=c('pickup_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_bad_weather'
do_weather<-taxitemp3%>%left_join(weather,by=c('dropoff_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_bad_weather'
taxitemp4<-cbind(taxitemp1,pu_weather,do_weather)
d<-dim(taxitemp4)
d
head(taxitemp4)
taxitemp2<-taxitemp1%>%mutate(pu_wl=if_else(PUnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(PUnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxitemp3<-taxitemp2%>%mutate(do_wl=if_else(DOnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(DOnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#left join weather data
pu_weather<-taxitemp3%>%left_join(weather,by=c('pickup_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_bad_weather'
do_weather<-taxitemp3%>%left_join(weather,by=c('dropoff_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_bad_weather'
taxitemp4<-cbind(taxitemp1,pu_weather,do_weather)
d<-dim(taxitemp4)
PUcount<- taxitemp4%>%
select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
tally()
DOcount<- taxitemp4%>%
select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
tally()
PUfpd<- taxitemp4%>%
group_by(pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
mutate(totaldist=sum(trip_distance),
totalfare=sum(fare_amount))%>%
select(pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather, totaldist, totalfare)
DOfpd<- taxitemp4%>%
group_by(dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
mutate(totaldist=sum(trip_distance),
totalfare=sum(fare_amount))%>%
select(dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather, totaldist, totalfare)
PUcount
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
dim(PUcount)
dim(DOcount)
dim(PUfpd)
dim(DOfpd)
head(PUcount)
head(PUfpd)
PUfpd%>%filter(PUnbhd=='Upper West Side')
PUfpd%>%filter(PUnbhd=='Upper West Side')
PUcount<- taxitemp4%>%
select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
tally()
DOcount<- taxitemp4%>%
select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
tally()
PUfpd<- taxitemp4%>%
group_by(pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
mutate(totaldist=sum(trip_distance),
totalfare=sum(fare_amount))%>%
select(pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather, totaldist, totalfare)
DOfpd<- taxitemp4%>%
group_by(dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
mutate(totaldist=sum(trip_distance),
totalfare=sum(fare_amount))%>%
select(dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather, totaldist, totalfare)%>%
unique()
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
dim(PUcount)
dim(DOcount)
dim(PUfpd)
dim(DOfpd)
head(PUcount)
head(PUfpd)
PUcount<- taxitemp4%>%
select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
tally()
DOcount<- taxitemp4%>%
select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
tally()
PUfpd<- taxitemp4%>%
group_by(pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount))%>%
select(pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather, totaldist, totalfare)
DOfpd<- taxitemp4%>%
group_by(dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
mutate(totaldist=sum(trip_distance),
totalfare=sum(fare_amount))%>%
select(dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather, totaldist, totalfare)%>%
unique()
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
dim(PUcount)
dim(DOcount)
dim(PUfpd)
dim(DOfpd)
head(PUcount)
head(PUfpd)
?tally
?summarize
#PU<- taxitemp4%>%
#  select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
#  group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
#  tally()
#DO<- taxitemp4%>%
#  select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
#  group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
#  tally()
PU<- taxitemp4%>%
group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount),
count=n())%>%
select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather, totaldist, totalfare, count)
DO<- taxitemp4%>%
group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount),
count=n())%>%
select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather, totaldist, totalfare, count)
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
#dim(PUcount)
#dim(DOcount)
#dim(PUfpd)
#dim(DOfpd)
dim(PU)
dim(DO)
head(PU)
head(PU)
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
#dim(PUcount)
#dim(DOcount)
#dim(PUfpd)
#dim(DOfpd)
dim(PU)
dim(DO)
head(PU)
head(DO)
PU%>%filter(PUnbhd=='Upper West Side')
ex=PU%>%filter(PUnbhd=='Upper West Side')
ex%>%mutate(fpd=totalfare/totaldist)
ex=DO%>%filter(PUnbhd=='Upper West Side')
ex=DO%>%filter(DOnbhd=='Upper West Side')
ex%>%mutate(fpd=totalfare/totaldist)
library(sp)
library(dplyr)
setwd("../")
getwd()
a
b
c
d
e
library(sp)
library(dplyr)
setwd("../")
getwd()
################################
#########change this############
################################
load('taxi2016_9.RData')
load('../output/nyc_nbhd.RData')
weather<-read.csv('../data/weather_small.csv',as.is=TRUE)
#taxi2016_9
(a_raw<-dim(taxi2016_9))
head(taxi2016_9)
(a_raw<-dim(taxi2016_9))
head(taxi2016_9)
filtaxi <- taxi2016_9%>%
mutate(fpd=fare_amount/trip_distance)%>%
filter(trip_distance<80 & trip_distance>0)%>%
filter(fare_amount<200 & fare_amount>0)%>%
filter(fpd<10 & fpd>0.5)
(b_filter<-dim(filtaxi))
#filtaxi%>%select(fpd)%>%boxplot()
nbhd<-function(ll){
colnames(ll)=c('lon','lat')
ll_spdf<-ll
coordinates(ll_spdf)= ~lon + lat
proj4string(ll_spdf) <- proj4string(nyc_nbhd)
match<-over(ll_spdf, nyc_nbhd)
return(match[,c(1,3)])
}
punbhd<-filtaxi%>%
select(pickup_longitude,pickup_latitude)%>%
nbhd()
colnames(punbhd)<-c('PUnbhd','PUnbhdBorough')
donbhd<-filtaxi%>%
select(pickup_longitude,pickup_latitude)%>%
nbhd()
colnames(donbhd)<-c('DOnbhd','DOnbhdBorough')
dim(punbhd)
dim(donbhd)
taxitemp<-cbind(filtaxi,punbhd,donbhd)
dim(taxitemp)
taxitemp1<- taxitemp%>%na.omit()
(c_nbhd_naomit<-dim(taxitemp1))
head(taxitemp1)
taxitemp2<-taxitemp1%>%mutate(pu_wl=if_else(PUnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(PUnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxitemp3<-taxitemp2%>%mutate(do_wl=if_else(DOnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(DOnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#left join weather data
pu_weather<-taxitemp3%>%left_join(weather,by=c('pickup_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_bad_weather'
do_weather<-taxitemp3%>%left_join(weather,by=c('dropoff_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_bad_weather'
taxitemp4<-cbind(taxitemp1,pu_weather,do_weather)
d<-dim(taxitemp4)
taxitemp2<-taxitemp1%>%mutate(pu_wl=if_else(PUnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(PUnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxitemp3<-taxitemp2%>%mutate(do_wl=if_else(DOnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(DOnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#left join weather data
pu_weather<-taxitemp3%>%left_join(weather,by=c('pickup_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_bad_weather'
do_weather<-taxitemp3%>%left_join(weather,by=c('dropoff_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_bad_weather'
taxitemp4<-cbind(taxitemp1,pu_weather,do_weather)
d_final<-dim(taxitemp4)
taxitemp2<-taxitemp1%>%mutate(pu_wl=if_else(PUnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(PUnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxitemp3<-taxitemp2%>%mutate(do_wl=if_else(DOnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(DOnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#left join weather data
pu_weather<-taxitemp3%>%left_join(weather,by=c('pickup_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_bad_weather'
do_weather<-taxitemp3%>%left_join(weather,by=c('dropoff_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_bad_weather'
taxitemp4<-cbind(taxitemp1,pu_weather,do_weather)
(d_final<-dim(taxitemp4))
(d_final<-dim(taxitemp4%>%na.omit()))
taxitemp<-cbind(filtaxi,punbhd,donbhd)
dim(taxitemp)
taxitemp1<- taxitemp%>%na.omit()
(c_nbhd_naomit<-dim(taxitemp1))
head(taxitemp1)
taxitemp2<-taxitemp1%>%mutate(pu_wl=if_else(PUnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(PUnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
taxitemp3<-taxitemp2%>%mutate(do_wl=if_else(DOnbhdBorough %in% c('Manhattan', 'Bronx', 'Unknown')
, 'NY CITY CENTRAL PARK, NY US',
if_else(DOnbhdBorough %in% c('Brooklyn','Queens')
, 'LA GUARDIA AIRPORT, NY US'
,'WOODBRIDGE TWP 1.1 ESE, NJ US')))
#left join weather data
pu_weather<-taxitemp3%>%left_join(weather,by=c('pickup_date'='DATE','pu_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(pu_weather)<-'pu_bad_weather'
do_weather<-taxitemp3%>%left_join(weather,by=c('dropoff_date'='DATE','do_wl'='NAME'))%>%select(BAD_WEATHER)
colnames(do_weather)<-'do_bad_weather'
taxitemp4<-cbind(taxitemp1,pu_weather,do_weather)
(d_final<-dim(taxitemp4%>%na.omit()))
PU<- taxitemp4%>%
group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount),
count=n())%>%
select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather, totaldist, totalfare, count)
DO<- taxitemp4%>%
group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount),
count=n())%>%
select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather, totaldist, totalfare, count)
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
#dim(PUcount)
#dim(DOcount)
#dim(PUfpd)
#dim(DOfpd)
dim(PU)
dim(DO)
head(PU)
head(DO)
#ex=DO%>%filter(DOnbhd=='Upper West Side')
#ex%>%mutate(fpd=totalfare/totaldist)
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
#dim(PUcount)
#dim(DOcount)
#dim(PUfpd)
#dim(DOfpd)
dim(PU)
dim(DO)
head(PU)
head(DO)
a_raw
b_filter
c_nbhd_naomit
d_final
#ex=DO%>%filter(DOnbhd=='Upper West Side')
#ex%>%mutate(fpd=totalfare/totaldist)
a_raw
b_filter
c_nbhd_naomit
d_final
rbind(a_raw,
b_filter,
c_nbhd_naomit,
d_final)
PU<- taxitemp4%>%
group_by(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount),
count=n())%>%
select(pickup_date, pickup_hour, PUnbhd, PUnbhdBorough, pu_bad_weather, totaldist, totalfare, count)
DO<- taxitemp4%>%
group_by(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather)%>%
summarize(totaldist=sum(trip_distance),
totalfare=sum(fare_amount),
count=n())%>%
select(dropoff_date, dropoff_hour, DOnbhd, DOnbhdBorough, do_bad_weather, totaldist, totalfare, count)
#xx=taxitemp1%>%group_by(PUnbhd,PUnbhdBorough)%>%tally()
#sum(table(xx$PUnbhd)>1)
#dim(PUcount)
#dim(DOcount)
#dim(PUfpd)
#dim(DOfpd)
dim(PU)
dim(DO)
head(PU)
head(DO)
dim<-rbind(a_raw,b_filter,c_nbhd_naomit,d_final)
#ex=DO%>%filter(DOnbhd=='Upper West Side')
#ex%>%mutate(fpd=totalfare/totaldist)
save(PU, DO, dim, file = "update_taxi9example.RData")
load("/Users/yeyejiang/Documents/GitHub/Spring2019-Proj2-grp11/map1_temp/update_taxi9example.RData")
